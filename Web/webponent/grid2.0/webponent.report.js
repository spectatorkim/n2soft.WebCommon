(function(){if(window.webponent===undefined){window.webponent={};}webponent.report={};var c=webponent.report;window.webponent.report.event=$({});var e=window.webponent.report.event;var d={excel:"/WEB-APP/export/excel",csv:"/WEB-APP/export/csv",pdf:"/WEB-APP/export/pdf",image:"/WEB-APP/export/image"};function b(l){var j=l+"=";var i=0,k;while(i<=document.cookie.length){var m=(i+j.length);if(document.cookie.substring(i,m)===j){if((k=document.cookie.indexOf(";",m))===-1){k=document.cookie.length;}return encodeURI(document.cookie.substring(m,k));}i=document.cookie.indexOf(" ",i)+1;if(i===0){break;}}return"";}function a(j){var i=new Date();i.setTime(i.getTime()-1);document.cookie=j+"=; expires="+i.toGMTString();}function h(m,k){k=$(k);k.attr("method","post");for(var j in m){var l=m[j];if(l){var i=$('<input type="hidden"/>');i.attr("name",j);i.val(l);k.append(i);}}return k;}function f(i,m,o,l){var k=l.action?l.action:"download";if(k===undefined||k==="download"){k="download";}else{if(typeof k==="object"){for(var s in k){m[s]=k[s];}}else{if(typeof k==="string"){m.action=k;}}}var n=l.mode?l.mode:"normal";m.mode=n;i=h(m,i);var r=l.exportHost?l.exportHost:"";var t=r+d[o];var q=l.ajax?true:false;if(!q){if(k==="download"){var p="webponent-report-downloader";a(p);var j=setInterval(function(){var u=b(p);if(u!==""){a(p);clearInterval(j);if(l.callback){l.callback();}}},50);}i.attr("action",t);i.trigger("submit");i.children().remove();}else{$.ajax({type:"POST",url:t,data:i.serialize(),beforeSend:function(){e.trigger("ajaxBegin");},success:function(u){if(l.ajax.success){l.ajax.success(u);}},complete:function(){e.trigger("ajaxComplete");i.children().remove();}});}}function g(j){var i="$LZString_ ";if(window.LZString){return i+window.LZString.compressToEncodedURIComponent(j);}else{return j;}}c.excel=function(s,k,v){var l=[];if(s instanceof Object&&s instanceof Array){l=s;}else{if(s instanceof Object){l.push(s);}}var q={};for(var t in l){var p,r;var o=l[t];if(l[0].header){p=JSON.stringify(o.header);r=JSON.stringify(o.body);}else{var m=function(){var w={};var x=$(o.rows);var y=$(x[0]);y.each(function(z){$(y[z]).find("td").each(function(B){var A=this.dataset.name;if(!w[A]){w[A]={};}w[A].level=Number(z);});});x.each(function(z){$(this).find("td").each(function(){var A=this.dataset.name;if(this.hasAttribute("rowspan")){if(!w[A][z]){w[A][z]={};}w[A][z].rowspan=Number(this.getAttribute("rowspan"));}if(this.hasAttribute("colspan")){if(!w[A][z]){w[A][z]={};}w[A][z].colspan=Number(this.getAttribute("colspan"));}});});return w;};var n=["bind","visibility","label","colspan","rowspan","level"];p=JSON.stringify(o.settings.columns,n);r=JSON.stringify(o.data);var j=m();if(typeof j==="object"){var u=JSON.stringify(j);q["bodyMergeInfo"+t]=g(u);}}q["header"+t]=g(p);q["body"+t]=g(r);var i=v.sheetName;if(i instanceof Array){q["sheetName"+t]=i[t];}else{q.sheetName0=i;}}q.count=l.length;q.fileName=v.fileName;f(k,q,"excel",v);};c.pdf=function(k,r){if(!r){console.log("option object 요소 입력 필");return;}var z={};var A=r.template;if(!A){A="default";}z.template=A;if(r.url){z.url=r.url;z.use="url";}else{if(r.drawArea){var y=r.drawArea;if(typeof y==="object"){if(y.appendRow!==undefined){y.releaseScroll();var u=y.markup.area.outerHTML;var m=$(u).clone();$(m).find(".CI-GRID-PAGING").remove();u=$(m)[0].outerHTML;var B=y.data;var j=y.settings.paging;var t=y.settings.template.original.clone();var s=$("<div>");$(y.markup.area).after(s);y.destroy();var p={};if(j.countPerPage!==null){p.paging=j;}y=webponent.grid.init(s,t,p);y.appendRow(B);y.makePageList();$.extend(true,r.drawArea,y);var w=$("<html></html>");var l=$("<head></head>");l.append('<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">');var x=r.stylesheet;if(x){for(var v=0,o=x.length;v<o;v++){var n=$('<link rel="stylesheet">');n.attr("href",x[v]);l.append(n);}}w.append(l);var q=$("<body></body>");q.append(u);w.append(q);w=w[0].outerHTML;z.HTML=g(w);}else{z.HTML=g(y.outerHTML);}}else{if(typeof y==="string"){z.HTML=g(y);}}}}if(r.param){z.param=g(JSON.stringify(r.param));}if(r.pdfHeader){z.pdfHeader=g(JSON.stringify(r.pdfHeader));}if(r.pdfFooter){z.pdfFooter=g(JSON.stringify(r.pdfFooter));}z.fileName=r.fileName;f(k,z,"pdf",r);};c.image=function(l,k){if(!k){return;}else{var j=k.template;if(!j){j="default";}var m={};var i=k.drawArea;if(i){if(typeof i==="object"){m.HTML=g(i.outerHTML);}else{if(typeof i==="string"){m.HTML=g(i);}}}else{m.SVGSTRING=k.SVGSTRING;}m.fileName=k.fileName;m.template=j;m.type=k.type;f(l,m,"image",k);}};c.csv=function(m,k,t){var n=["bind","visibility","label","bindColumn"];var p={};var o="",q="";var s=m.header?_.max(m.header,function(i){return i.level;}).level:_.max(m.settings.columns,function(i){return i.level;}).level;function r(y){var x=[];var C=[];var w={label:""};function D(){var E=false;var i=false;$.each(y,function(G,F){if(F.colspan>1){E=true;}});$.each(y,function(G,F){if(F.rowspan>1){i=true;}});if(i&&!E){$.each(y,function(G,F){F.level=0;});}}D();for(var B=0;B<s+1;B++){x.push(_.select(y,function(i){return i.level===B;}));for(var u=0;u<x[B].length;u++){if(B===0&&x[B][u].colspan<2){x[B][u].bindColumn=true;}if(B===s){x[B][u].bindColumn=true;}}for(var A=0;A<x[B].length;A++){if(x[B][A].colspan>1){for(var z=0;z<x[B][A].colspan-1;z++){x[B].splice(A+1,0,w);}}}if(B===0){for(var z=0;z<x[B].length;z++){if(x[B][z].rowspan>1){C.push(z);}}}else{for(var v=0;v<C.length;v++){x[B].splice(C[v],0,w);}}}return x;}if(m.header){o=JSON.stringify(r(m.header));q=JSON.stringify(m.body);}else{var j=r(m.settings.columns);for(var l=0;l<j.length;l++){if(l===j.length-1){o+='"'+l+'":'+JSON.stringify(j[l],n);}else{o+='"'+l+'":'+JSON.stringify(j[l],n)+",";}}q=JSON.stringify(m.data);}o="{"+o+"}";p.header=g(o);p.body=g(q);p.fileName=t.fileName;f(k,p,"csv",t);};})();